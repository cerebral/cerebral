# @cerebral/mobx-state-tree

Combine Cerebral with Mobx state-tree.

## Install

`npm install @cerebral/mobx-state-tree`

## Description

Use the [mobx-state-tree](https://github.com/mobxjs/mobx-state-tree) project as state layer of Cerebral. Use mobx project way of connecting to components and ignore using computed in Cerebral.

## Instantiate

Instead of creating the controller from `cerebral`, you create it from this package. Also any modules should be created from this package:

```js
import { Controller, Module } from '@cerebral/mobx-state-tree'

const app = Module({
  // definition
})

export default Controller(app, {
  // options
})
```

## considerations

There are a couple of minor things to consider when using this addon.

1.  Any addons defining state, like **@cerebral/useragent**, will not work with this addon, due
    to the missing types definitions. Though for example **cerebral/router** will work as it does not have any state

2.  Avoid using **types.reference**, rather define it as a string and do manual lookup. The reason is simply that the debugger does not understand reference, though it works perfectly fine

## state and model

With Mobx state tree you also define models, in addition to state. You do this directly in your modules:

_modules/app.js_

```js
import { Module } from '@cerebral/mobx-state-tree'
import { types } from 'mobx-state-tree'
import { set } from 'cerebral/factories'
import { state, props } from 'cerebral/tags'

export default Module({
  // Define the model. This can also include views
  model: types.model({
    name: types.string
  }),
  // Define the initial state as normal
  state: {
    name: ''
  },
  sequences: {
    nameChanged: set(state`name`, props`name`)
  }
})
```

## accessing state and props in components

For example using React you will need the package [mobx-react](https://github.com/mobxjs/mobx-react) and use the **provide()** method of the controller:

_main.js_

```js
import React from 'react'
import { render } from 'react-dom'
import controller from './controller'
import { Provider } from 'mobx-react'
import App from './components/App'

render(
  <Provider {...controller.provide()}>
    <App />
  </Provider>
)
```

_App.js_

```js
import React from 'react'
import { observer, inject } from 'mobx-react'

@inject('store', 'signals')
@observer
class App extends React.Component {
  render() {
    const { store, signals } = this.props

    return (
      <div>
        <h1>{store.sayHelloTo('Bob')}</h1>
        <input
          value={store.name}
          onChange={(event) =>
            signals.nameChanged({ name: event.target.value })
          }
        />
      </div>
    )
  }
}

export default App
```
