# @cerebral/mobx-state-tree

Combine Cerebral with Mobx state-tree.

## Install

`npm install @cerebral/mobx-state-tree`

## Description
Use the [mobx-state-tree](https://github.com/mobxjs/mobx-state-tree) project as state layer of Cerebral. Use mobx project way of connecting to components and ignore using computed in Cerebral.


## Instantiate

Instead of creating the controller from `cerebral`, you create it from this package:

```js
import {Controller} from '@cerebral/mobx-state-tree'
import app from './modules/app'

export default Controller({
  modules: {app}
  // Other config options are the same
})
```

## considerations
There are a couple of minor things to consider when using this addon.

1. Any addons defining state, like **@cerebral/useragent**, will not work with this addon, due
to the missing types definitions. Though for example **cerebral/router** will work as it does not have any state

2. Avoid using **types.reference**, rather define it as a string and do manual lookup, as in the example below. The reason is simply that the debugger does not understand reference, though it works perfectly fine

3. The mobx-state-tree controller does not support state and signals defined directly on the controller

## state and model

With Mobx state tree you also define models, in addition to state. You do this directly in your modules:

*modules/app.js*
```js
import { types } from 'mobx-state-tree'
import {set} from 'cerebral/operators'
import {state, props} from 'cerebral/tags'

const Box = types.model('Box', {
  id: types.identifier(),
  name: '',
  x: 0,
  y: 0,
  get width() {
    return this.name.length * 15
  }
})

export default {
  // Define your model as an object,
  // it will be converted to a types.model
  model: {
    boxes: types.map(Box),
    currentBoxId: types.maybe(types.string)
  },
  // Define the initial state as normal
  state: {
    boxes: {},
    currentBoxId: null
  },
  // You can define views as normal. It is encouraged to do so directly
  // on the module, though nested models can of course also have views. Note
  // that views are only to GET state, not to change it. Meaning that in actions
  // do not use views with for example state.set etc., only state.get
  views(state) {
    return {
      currentBox() {
        return state.boxes[state.currentBoxId]
      }
    }
  },
  signals: {
    boxSelected: set(state`app.currentBoxId`, props`boxId`)
  }
}
```

## accessing state and props in components

For example using React you will need the package [mobx-react]() and use the **provide()** method of the controller:

*main.js*
```js
import React from 'react'
import {render} from 'react-dom'
import controller from './controller'
import {Provider} from 'mobx-react'
import App from './components/App'

render((
  <Provider {...controller.provide()}>
    <App />
  </Provider>
))
```

*App.js*
```js
import React from 'react'
import {observer, inject} from 'mobx-react'

@observer
@inject('store', 'signals')
class App extends React.Component {
  renderBoxes () {
    const {store, signals} = this.props

    return Object.keys(store.app.boxes).map((boxId) => {
      return (
        <li onClick={() => signals.app.boxSelected({boxId})}>
          {store.app.boxes[boxId].name}
        </li>
      )
    })
  }
  render () {
    const {store} = this.props
    const currentBox = store.app.currentBox

    return (
      <div>
        <h1>{currentBox ? currentBox.name : 'no box selected'}</h1>
        <ul>
          {this.renderBoxes()}
        </ul>
      </div>
    )
  }
}

export default App
```
