import Router from './router'

let addressbar
try {
  addressbar = require('addressbar')
} catch (e) {
  addressbar = {
    pathname: '/',
    value: '',
    origin: '',
    on() {},
    removeListener() {},
  }
}

export default function(options = {}) {
  if (!options.mapper || typeof options.mapper.map !== 'function') {
    throw new Error('Cerebral router - mapper option must be provided.')
  }

  if (options.addressbar && typeof options.addressbar.value !== 'string') {
    throw new Error(
      'Cerebral router - option addressbar must be addressbar implementation'
    )
  }

  return ({ controller }) => {
    return new Router(
      controller,
      options.addressbar || addressbar,
      options.mapper,
      options
    )
  }
}
