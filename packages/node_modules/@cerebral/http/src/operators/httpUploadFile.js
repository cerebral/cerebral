import { processResponse } from '../utils'
import { convertObjectWithTemplates } from 'cerebral/tags'

function uploadFileFactory(urlValue, filesValue, optionsValue = {}) {
  function uploadFile({ http, resolve, path }) {
    const url = resolve.value(urlValue)
    const files = resolve.value(filesValue)
    const options = convertObjectWithTemplates(
      optionsValue,
      resolve,
      'http.uploadFile'
    )

    return processResponse(http.uploadFile(url, files, options), path)
  }
  return uploadFile
}

export default uploadFileFactory
