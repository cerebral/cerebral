/* eslint-env mocha */
import { Controller, parallel, Module } from '../'
import assert from 'assert'
import { debounce } from './'

describe('operator.debounce', () => {
  it('should debounce execution', (done) => {
    const result = []
    const rootModule = Module({
      signals: {
        test: [
          debounce(50),
          {
            continue: [
              () => {
                assert.deepEqual(result, ['discard'])
                done()
              },
            ],
            discard: [
              () => {
                result.push('discard')
              },
            ],
          },
        ],
      },
    })
    const controller = Controller(rootModule)
    controller.getSignal('test')()
    setTimeout(() => {
      controller.getSignal('test')()
    }, 10)
  })
  it('should debounce execution in parallel', (done) => {
    const result = []
    const rootModule = Module({
      signals: {
        test: [
          parallel([
            debounce(50),
            {
              continue: [
                () => {
                  assert.deepEqual(result, ['parallel', 'parallel', 'discard'])
                  done()
                },
              ],
              discard: [
                () => {
                  result.push('discard')
                },
              ],
            },
            () => {
              result.push('parallel')
            },
          ]),
        ],
      },
    })
    const controller = Controller(rootModule)
    controller.getSignal('test')()
    setTimeout(() => {
      controller.getSignal('test')()
    }, 10)
  })
})
