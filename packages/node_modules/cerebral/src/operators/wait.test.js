/* eslint-env mocha */
import { Controller, Module, parallel } from '../'
import assert from 'assert'
import { wait } from './'

describe('operator.wait', () => {
  it('should hold execution for set time', (done) => {
    const start = Date.now()
    const rootModule = Module({
      signals: {
        test: [
          wait(100),
          () => {
            assert.ok(Date.now() - start >= 100)
            done()
          },
        ],
      },
    })
    const controller = Controller(rootModule)
    controller.getSignal('test')()
  })
  it('should hold execution for set time in parallel', (done) => {
    const start = Date.now()
    const rootModule = Module({
      signals: {
        test: [
          parallel([
            wait(100),
            {
              continue: [
                () => {
                  assert.ok(Date.now() - start >= 100)
                  done()
                },
              ],
            },
          ]),
        ],
      },
    })
    const controller = Controller(rootModule)
    controller.getSignal('test')()
  })
})
