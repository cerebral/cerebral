import Watch from './Watch'

export class Reaction extends Watch {
  constructor(dependencies, cb) {
    super('Reaction')
    this.dependencies = dependencies
    this.cb = cb
  }
  initialize() {
    this.getter = (tag) => tag.getValue(this.controller.createContext())
    this.subscribe(this.cb.bind(null, this.getter))
  }
  createDependencyMap() {
    return this.controller.createDependencyMap(
      Object.keys(this.dependencies).map((key) => this.dependencies[key]),
      null,
      this.modulePath
    )
  }
}

export default (dependencies = {}) => {
  return (cb) => {
    return new Reaction(dependencies, cb)
  }
}
