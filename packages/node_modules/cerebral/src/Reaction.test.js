/* eslint-env mocha */
import { Controller, Module, Reaction } from './'
import { state } from './tags'
import assert from 'assert'

describe('Reaction', () => {
  it('should watch state', () => {
    let grabbedValue = 0
    const foo = Reaction(
      {
        foo: state`foo`,
      },
      ({ foo }) => {
        grabbedValue = foo
      }
    )
    const app = Module({
      reactions: {
        foo,
      },
      state: {
        foo: 'bar',
      },
      sequences: {
        changeFoo: ({ operators }) => operators.set(state`foo`, 'bar2'),
      },
    })
    const controller = Controller(app)
    controller.getSequence('changeFoo')()
    assert.equal(grabbedValue, 'bar2')
  })
  it('should grab state dynamically', () => {
    let grabbedValue = null
    const foo = Reaction(
      {
        foo: state`foo`,
      },
      ({ foo, get }) => {
        grabbedValue = foo + get(state`bar`)
      }
    )
    const app = Module({
      reactions: {
        foo,
      },
      state: {
        foo: 'bar',
        bar: 'baz',
      },
      sequences: {
        changeFoo: ({ operators }) => operators.set(state`foo`, 'bar2'),
      },
    })
    const controller = Controller(app)
    controller.getSequence('changeFoo')()
    assert.equal(grabbedValue, 'bar2baz')
  })
})
