/* eslint-env mocha */
import App, { Reaction } from './'

import assert from 'assert'
import { state } from './tags'

describe('Reaction', () => {
  it('should watch state', () => {
    let grabbedValue = 0
    const foo = Reaction(
      {
        foo: state`foo`,
      },
      ({ foo }) => {
        grabbedValue = foo
      }
    )
    const app = {
      reactions: {
        foo,
      },
      state: {
        foo: 'bar',
      },
      sequences: {
        changeFoo: ({ store }) => store.set(state`foo`, 'bar2'),
      },
    }
    const controller = App(app)
    controller.getSequence('changeFoo')()
    assert.equal(grabbedValue, 'bar2')
  })
  it('should grab state dynamically', () => {
    let grabbedValue = null
    const foo = Reaction(
      {
        foo: state`foo`,
      },
      ({ foo, get }) => {
        grabbedValue = foo + get(state`bar`)
      }
    )
    const app = {
      reactions: {
        foo,
      },
      state: {
        foo: 'bar',
        bar: 'baz',
      },
      sequences: {
        changeFoo: ({ store }) => store.set(state`foo`, 'bar2'),
      },
    }
    const controller = App(app)
    controller.getSequence('changeFoo')()
    assert.equal(grabbedValue, 'bar2baz')
  })
})
