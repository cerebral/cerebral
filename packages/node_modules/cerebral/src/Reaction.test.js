/* eslint-env mocha */
import { Controller, Module, Reaction } from './'
import { state } from './tags'
import assert from 'assert'

describe('Reaction', () => {
  it('should watch state', () => {
    let watchedCount = 0
    const foo = Reaction({
      foo: state`foo`,
    })(() => watchedCount++)
    const app = Module({
      reactions: {
        foo,
      },
      state: {
        foo: 'bar',
      },
      signals: {
        changeFoo: ({ operators }) => operators.set(state`foo`, 'bar2'),
      },
    })
    const controller = Controller(app)
    controller.getSignal('changeFoo')()
    assert.equal(watchedCount, 1)
  })
  it('should watch state', () => {
    let grabbedValue = null
    const foo = Reaction({
      foo: state`foo`,
    })((get) => {
      grabbedValue = get(state`foo`)
    })
    const app = Module({
      reactions: {
        foo,
      },
      state: {
        foo: 'bar',
      },
      signals: {
        changeFoo: ({ operators }) => operators.set(state`foo`, 'bar2'),
      },
    })
    const controller = Controller(app)
    controller.getSignal('changeFoo')()
    assert.equal(grabbedValue, 'bar2')
  })
})
