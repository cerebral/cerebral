/* eslint-env mocha */
import { Controller, Module } from '../'
import assert from 'assert'
import { splice } from './'
import { props, state } from '../tags'

describe('operator.splice', () => {
  it('should splice value in model', () => {
    const rootModule = Module({
      state: {
        list: ['a', 'b', 'c', 'd'],
      },
      sequences: {
        test: [splice(state`list`, 1, 2, 'x', 'y')],
      },
    })
    const controller = Controller(rootModule)
    controller.getSequence('test')()
    assert.deepEqual(controller.getState(), { list: ['a', 'x', 'y', 'd'] })
  })
  it('should splice value from props in model', () => {
    const rootModule = Module({
      state: {
        list: ['a', 'b', 'c', 'd'],
      },
      sequences: {
        test: [splice(state`list`, props`idx`, 1, props`x`, props`y`)],
      },
    })
    const controller = Controller(rootModule)
    controller.getSequence('test')({ idx: 2, x: 'one', y: 'two' })
    assert.deepEqual(controller.getState(), {
      list: ['a', 'b', 'one', 'two', 'd'],
    })
  })
  it('should throw on bad argument', (done) => {
    const rootModule = Module({
      state: {},
      sequences: {
        test: [splice(props`list`, 1, 1, 'bar')],
      },
    })
    const controller = Controller(rootModule)

    controller.removeListener('error')
    controller.once('error', (error) => {
      assert.ok(error)
      done()
    })

    controller.getSequence('test')()
  })
})
