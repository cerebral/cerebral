/* eslint-env mocha */
import { props, state } from '../tags'

import App from '../'
import assert from 'assert'
import { concat } from './'

describe('factory.concat', () => {
  it('should concat literal array in model', () => {
    const rootModule = {
      state: {
        list: ['one'],
      },
      sequences: {
        test: [concat(state`list`, ['two'])],
      },
    }
    const controller = App(rootModule)
    controller.getSequence('test')()
    assert.deepStrictEqual(controller.getState(), { list: ['one', 'two'] })
  })
  it('should concat state array in model', () => {
    const rootModule = {
      state: {
        list: ['one'],
        list2: ['two', 'three'],
      },
      sequences: {
        test: [concat(state`list`, state`list2`)],
      },
    }
    const controller = App(rootModule)
    controller.getSequence('test')()
    assert.deepStrictEqual(controller.getState(), {
      list: ['one', 'two', 'three'],
      list2: ['two', 'three'],
    })
  })
  it('should throw on bad argument', (done) => {
    const rootModule = {
      state: {
        list: ['one'],
      },
      sequences: {
        test: [concat(props`list`, ['two'])],
      },
    }
    const controller = App(rootModule)

    controller.removeListener('error')
    controller.once('error', (error) => {
      assert.ok(error)
      done()
    })

    controller.getSequence('test')()
  })
})
