/* eslint-env mocha */
import { Controller, Module } from '../'
import assert from 'assert'
import { equals } from './'
import { state, props } from '../tags'

describe('operator.equals', () => {
  it('should go down path based on props', () => {
    let count = 0
    const rootModule = Module({
      state: {
        foo: 'bar',
      },
      sequences: {
        test: [
          equals(props`foo`),
          {
            bar: [
              () => {
                count++
              },
            ],
            otherwise: [],
          },
        ],
      },
    })
    const controller = Controller(rootModule)
    controller.getSequence('test')({ foo: 'bar' })
    assert.equal(count, 1)
  })
  it('should go down path based on state', () => {
    let count = 0
    const rootModule = Module({
      state: {
        foo: 'bar',
      },
      sequences: {
        test: [
          equals(state`foo`),
          {
            bar: [
              () => {
                count++
              },
            ],
            otherwise: [],
          },
        ],
      },
    })
    const controller = Controller(rootModule)
    controller.getSequence('test')()
    assert.equal(count, 1)
  })
  it('should throw on bad argument', (done) => {
    const rootModule = Module({
      state: {
        foo: 'bar',
      },
      sequences: {
        test: [
          equals('foo'),
          {
            bar: [() => {}],
            otherwise: [],
          },
        ],
      },
    })
    const controller = Controller(rootModule)
    controller.removeListener('error')
    controller.once('error', (error) => {
      assert.ok(error)
      done()
    })
    controller.getSequence('test')()
  })
})
