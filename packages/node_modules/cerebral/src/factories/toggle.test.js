/* eslint-env mocha */
import { Controller, Module } from '../'
import assert from 'assert'
import { toggle } from './'
import { props, state } from '../tags'

describe('operator.toggle', () => {
  it('should toggle state', () => {
    const rootModule = Module({
      state: {
        foo: true,
      },
      signals: {
        test: [toggle(state`foo`)],
      },
    })
    const controller = Controller(rootModule)
    controller.getSignal('test')()
    assert.deepEqual(controller.getState(), { foo: false })
  })
  it('should toggle state with props', () => {
    const rootModule = Module({
      state: {
        todos: {
          one: true,
          two: false,
        },
      },
      signals: {
        test: [toggle(state`todos.${props`ref`}`)],
      },
    })
    const controller = Controller(rootModule)
    controller.getSignal('test')({ ref: 'one' })
    assert.deepEqual(controller.getState(), {
      todos: { one: false, two: false },
    })
  })
  it('should throw on bad argument', (done) => {
    const rootModule = Module({
      state: {},
      signals: {
        test: [toggle(props`foo`)],
      },
    })
    const controller = Controller(rootModule)

    controller.removeListener('error')
    controller.once('error', (error) => {
      assert.ok(error)
      done()
    })

    controller.getSignal('test')()
  })
})
